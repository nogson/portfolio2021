---
id: 20230113
title: Docker初心者によるDocker Composeのメモ
description: Docker Compose関連のメモです
createdAt: 2023-01-13
thumbnail: blog/images/docker_thumb.png
category: Docker
---

Docker Compose関連のメモです。

## Docker Composeファイルを書いてみる

◎ docker-compose.yaml
```text
services:          ・・・ 1
 web:              ・・・ 1-A
  image: httpd:2.4 ・・・ 1-B
  ports:
   - "8080:80"     ・・・ 1-C
networks:          ・・・ 2
 net01:
volumes:           ・・・ 3
 vol01:
```

- 1: services配下に、コンテナの定義を書きます。
  - 1-A : コンテナ名です。Apache(httpd)を利用したWebServerなのでwebとしています。
  - 1-B : 利用するimage名を記述します。  
「httpd:2.4」の場合、Apacheのバージョン2.4を指定してます。
  - 1-C : Dockerホストとコンテナのポート番号の紐付けを文字列で指定します。  
「ホストのポート番号:コンテナのポート番号」
- 2: コンテナで利用するネットワーク設定。

- 3: データの保存に関する設定

### コンテナに環境変数設定する

コンテナでDBを作成した場合、ユーザー名や、パスワードを設定する為に環境変数を利用する為に`enviroment`を設定します。

例) MariaDBの場合  

設定できる環境変数は[こちら](https://hub.docker.com/_/mariadb)を参照する。

```yaml
services:
 db:
  image: mariadb
  environment:
    MARIADB_ROOT_PASSWORD: rootpass
    MARIADB_DATABASE: testdb
    MARIADB_USER: testuser
    MARIADB_PASSWORD: testpass
  volumes:
    - ./db_data:/var/lib/mysql
```

### 複数のコンテナを設定する

例) wordpress + mariadb
```shell
services:
 db:
  image: mariadb:10.7
  environment:
    MARIADB_ROOT_PASSWORD: rootpass
    MARIADB_DATABASE: testdb
    MARIADB_USER: testuser
    MARIADB_PASSWORD: testpass
  volumes:
    - ./db_data:/var/lib/mysql
wordpress:
 image: wordpress:6.0
 depends_on:
  - db
 environment:
   WORDPRESS_DB_HOST: db
   WORDPRESS_DB_NAME: wordpress
   WORDPRESS_DB_USER: wordpress
   WORDPRESS_DB_PASSWORD: wordpress
 ports:
  - "8080:80"
 volumes:
  data-data:
  wordpress-data:
```

複数のコンテナを利用する場合は、コンテナの依存関係を指定する`depends_on`を利用する。  
depends_onに`db`を指定すると、`db → wordpress`の順にコンテナを作成されます。

## Docker Composeで作成したコンテナを削除する

Docker Composeで作成したコンテナを削除する方法です。

#### 1. docker compose down

コンテナとそれに紐づくネットワークを削除します。  
コンテナ起動中でも実行できます。

```shell
docker compose down
```

#### 2. docker compose rm

コンテナのみ削除します。コンテナに紐づくネットワークは削除されません。  
コンテナ起動中は実行できないです。

```shell
docker compose rm
```

イメージも合わせて削除する場合は、`rmi` オプションを利用します。  

```shell
docker compose down --rmi all
```

※ 削除するイメージを利用しているコンテナが他にもある場合はエラーになります。
