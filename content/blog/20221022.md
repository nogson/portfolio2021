---
id: 20221022
title: ExpressとMongoDBでAPIサーバーを作る
description: node.jsを利用してバックエンドをやってみます。
createdAt: 2022-10-22
thumbnail: blog/images/note_thumb.png
category: Node.js
---

普段はフロントエンドをやることが多い（というかフロントしかできない）ので、node.jsを利用してバックエンド環境も準備してみます。

## 前提
- サーバーにExpressを利用
- DBにMongoDBを利用
- typescriptを利用
- Dockerは利用しない

## ファイル構成
とりあえずこんな感じ。

```
.
├── index.ts
├── node_modules
├── package-lock.json
├── package.json
├── src
    └── models
└── tsconfig.json

```


## バックエンドサーバーを用意

バックエンドサーバー用のExpressをインストール。

```
npm i express
```

ファイルを保存時にサーバーを自動で再起動してくれるNodemonをインストール。
```
npm i nodemon
```
↑に合わせて、package.jsonはサーバー立ち上げ用にscriptsだけ変更。

```
{
  "name": "server",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "start": "nodemon index.ts" // ←これ
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  ...

}
```

## ローカルサーバーを立ち上げ

Expressを利用してローカルサーバーを立ち上げます。

index.tsに追加。
```typescript
import express from 'express'
const app = express()
const PORT = 5050 // ポートはお好みで

app.listen(PORT, () => {
  console.log('ローカルサーバー起動中')
})
```

サーバーと立ち上げてみる。
```
$ npm run start
[nodemon] starting `ts-node index.ts`
サーバー起動中
```

サーバーが立ち上がっているか確認したい場合は、以下のようにルーティングを追加して確認してみます。


```typescript
import express from 'express'
const app = express()
const PORT = 5050 // ポートはお好みで

// localhost:5050をブラウザで確認してみる
app.get('/',(req,res) => {
    res.send('OK')
})

app.listen(PORT, () => {
  console.log('ローカルサーバー起動中')
})
```

## DBを用意する

データベースには[MongoDB](https://www.mongodb.com/ja-jp)を利用します。  
MongoDBのページから「無料で始める」のボタンを押して、signupします。

<dynamic-image path="blog/images/20221022/01.png" alt="DBを用意する" ></dynamic-image>

signupが完了したら、「New Project」から新規プロジェクトを作成します。

<dynamic-image path="blog/images/20221022/02.png" alt="DBを用意する" ></dynamic-image>
<dynamic-image path="blog/images/20221022/03.png" alt="DBを用意する" ></dynamic-image>
<dynamic-image path="blog/images/20221022/04.png" alt="DBを用意する" ></dynamic-image>

プロジェクトを作成したらデータベースも作成します。

<dynamic-image path="blog/images/20221022/05.png" alt="DBを用意する" ></dynamic-image>

無料で使いたいので、「FREE」を選択します。
Providerは「AWS」を選択、Regionは「Tokyo」を選択します。

<dynamic-image path="blog/images/20221022/06.png" alt="DBを用意する" ></dynamic-image>


プロジェクトへの認証方法を設定します。

ユーザー名とパスワードで認証するようにします。
<dynamic-image path="blog/images/20221022/07.png" alt="DBを用意する" ></dynamic-image>

接続環境を設定します。
とりあえずどこからでも接続できるようにするには`0.0.0.0`としておきます。  
接続IPを絞りたいなら、「Add My Current IP Address」を押すと、現在のIPが設定されます。

<dynamic-image path="blog/images/20221022/08.png" alt="DBを用意する" ></dynamic-image>



